<!doctype html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="{{ url_for('static', filename='d3.v7.js')}}"></script>

<link rel="stylesheet" href="{{ url_for('static', filename='css/bulma.css')}}">
<link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}" >
<title>Warszawskie spółdzielnie mieszkaniowe</title>
<style>
    .continent {
    fill: #fa8b8b;
    stroke: #e0cabc;
    stroke-width: 1px;
}



.labels {
    font-family: sans-serif;
    font-size: 11px;
    fill: #3c373d;
}

</style>
</head>

<body>
    <section class="hero">
        <div class="container">
        <div class="hero-body">
          <p class="title">
            Warszawskie spółdzielnie mieszkaniowe
          </p>
          <p class="subtitle">
            -wersja robocza-
          </p>
        </div>
    </div>
      </section>
<div class="container">
   

    <div id="chart"></div>
</div>
<div class="container">
    <br><br>
    <table class="table">
        <thead>
          <tr>
            <th>Lp.</th>
            <th>Nazwa</th>
            <th>KRS</th>
            <th>Adres</th>
            <th>Status</th>
  
          </tr>
        </thead>
  
      </table>
</div>
<div class="container">
    <br><br>
</div>
<footer class="footer">
    <div class="content has-text-centered">
      <p>
        <strong>Warszawskie spółdzielnie mieszkaniowe</strong> [wersja 2024-03-08]
</p>
      <p>
        Cześć przedstawionych danych pochodzi z zasobów publicznych. Niektóre dane mogą nie być prawdziwe. Twórcy nie ponoszą odpowiedzialności za ich poprawność.
      
      </p>
    </div>
  </footer>
<script type="module">


    var w = 1400;
    var h = 700;
    var svg = d3.select("div#chart").append("svg").attr("preserveAspectRatio", "xMinYMin meet")
    .attr("viewBox", "0 0 " + w + " " + h).style("background","#ffffaa")
    .classed("svg-content", true);

    var projection = d3.geoMercator().translate([w/2-100,h/2+570]).scale(86000).center([21,52]);
    var path = d3.geoPath().projection(projection);

    var warszawa = d3.json("{{ url_for('static', filename='dzielnice/warszawa.geojson') }}")
    var spoldzielnie = d3.json("{{ url_for('static', filename='dzielnice/spol.geojson') }}")
    var spol = d3.csv("{{ url_for('static', filename='warszawskie_spoldzielnie.csv') }}")

    Promise.all([warszawa, spoldzielnie, spol]).then(function(values){   
        console.log(values);

        values[0].features.forEach(function(feature) {
           feature.geometry.coordinates[0].reverse();
        });

        svg.selectAll("path")
            .data(values[0].features)
            .enter()
            .append("path")
            .attr("class","continent")
            .attr("d", path)

    //   svg.selectAll("circle")
    //     .data(values[1].features)
    //     .enter()
    //     .append("circle")
    //     .attr("class","circles")
    //     .attr("cx", function(d) {
    //         console.log(d.geometry.coordinates[0]);
    //         return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0];})
    //     .attr("cy", function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1];})
    //     .attr("r", "6px")

        svg.selectAll("circle")
        .data(values[2])
        .enter()
        .append("circle")
        .attr("class","circles")
        .attr("cx", function(d) {
            console.log(d);
            return projection([d.dlugosc_geo, d.szerokosc_geo])[0];})
        .attr("cy", function(d) {return projection([d.dlugosc_geo, d.szerokosc_geo])[1];})
        .attr("r", "6px")
        .attr("fill", function(d) {
            if (d.status == "uregulowane") {
                return "green"
            }
            else if (d.status == "niewiadomo") {
                return "yellow"
            } else {
                return "red"
            }
        })
        .attr("stroke", "black")
        .attr("stroke-width", 1)


        let tabela = d3.select("table")

            let wiersz = tabela.append("tbody")
            .selectAll("tr").data(values[2])
            .enter().append("tr")

            wiersz.append("td")
            .text(function (d,i) { return i+1; })

            wiersz.append("td")
            .text(function (d) { return d.nazwa })


            wiersz.append("td")
            .text(function (d) { return d.krs })

            wiersz.append("td")
            .text(function (d) { return d.adres+", "+d.kod_pocztowy+", "+d.miejscowosc})

            wiersz.append("td")
            .style("background-color", function(d) {
                if (d.status == "uregulowane") {
                    return "lightgreen"
                }
                else if (d.status == "niewiadomo") {
                    return "yellow"
                } else {
                    return "#ec6b6b"
                }
            })
            .text(function (d) { return d.status })




    });
    // d3.json("{{ url_for('static', filename='dzielnice/warszawa.geojson') }}").then(function(data) {
    //     console.log(data.features);

    //     // data.features.forEach(function(feature) {
    //     //     feature.geometry.coordinates[0].reverse();
    //     // });

    //     svg.selectAll("path")
    //     .data(data.features)
    //     .enter()
    //     .append("path")
    //     .attr("class","continent")
    //     .attr("d", path)



    // });

    // d3.json("{{ url_for('static', filename='dzielnice/spol.geojson') }}").then(function(data) {
    //     svg.selectAll("circle")
    //     .data(data.features)
    //     .enter()
    //     .append("circle")
    //     .attr("class","circles")
    //     .attr("cx", function(d) {
    //         console.log(d.geometry.coordinates[0]);
    //         return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0];})
    //     .attr("cy", function(d) {return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1];})
    //     .attr("r", "6px"),
    //     console.log(data);
    // });

</script>
</body>
</html>